---
deps: ['after']
group: power-users
status: in-progress # in-progress, complete
needs: content # content, tech-review, copy-review
---

## Interpretation

With the XState [interpreter](./interpretation.md), delayed actions will use the native`setTimeout` and `clearTimeout` functions:

```js
import { interpret } from 'xstate';

const actor = interpret(lightDelayMachine).onTransition((state) =>
  console.log(state.value)
);

actor.start();
// => 'green'

// (after 1 second)

// => 'yellow'
```

For testing, the XState interpreter provides a `SimulatedClock`:

```js
import { interpret } from 'xstate';
// import { SimulatedClock } from 'xstate/lib/interpreter'; // < 4.6.0
import { SimulatedClock } from 'xstate/lib/SimulatedClock'; // >= 4.6.0

const actor = interpret(lightDelayMachine, {
  clock: new SimulatedClock(),
}).onTransition((state) => console.log(state.value));

actor.start();
// => 'green'

// move the SimulatedClock forward by 1 second
actor.clock.increment(1000);
// => 'yellow'
```

You can create your own “clock” to provide to the interpreter. The clock interface is an object with two functions/methods:

- `setTimeout` - same arguments as `window.setTimeout(fn, timeout)`
- `clearTimeout` - same arguments as `window.clearTimeout(id)`

## Behind the scenes

The `after: ...` property does not introduce anything new to statechart semantics. Instead, it creates normal transitions that look like this:

```js
// ...
states: {
  green: {
    entry: [
      send(after(1000, 'light.green'), { delay: 1000 }),
      send(after(2000, 'light.green'), { delay: 2000 })
    ],
    onExit: [
      cancel(after(1000, 'light.green')),
      cancel(after(2000, 'light.green'))
    ],
    on: {
      [after(1000, 'light.green')]: {
        target: 'yellow',
        cond: 'trafficIsLight'
      },
      [after(2000, 'light.green')]: {
        target: 'yellow'
      }
    }
  }
}
// ...
```

The interpreted statechart will `send(...)` the `after(...)` events after their `delay`, unless the state node is exited, which will `cancel(...)` those delayed `send(...)` events.
