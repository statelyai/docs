---
title: Guards
---

import ThemedImage from '@theme/ThemedImage';
import useBaseUrl from '@docusaurus/useBaseUrl';

A **guard** is a condition that the machine checks when it goes through an event. If the condition is true, the machine follows the transition to the next state. If the condition is false, the machine follows the rest of the conditions to the next state. Any transition can be a guarded transition.

```ts
const feedbackMachine = createMachine({
  // ...
  states: {
    form: {
      on: {
        'feedback.submit': {
          guard: 'isValid',
          target: 'submitting',
        },
      },
    },
    submitting: {
      // ...
    },
  },
});
```

## Editor: using guards

<p>
  <ThemedImage
    alt="A video player state machine with an initial Paused State and a Playing state. The transition from Playing to Paused has a guard numbered 1 and labeled ‘If time left is zero’. The first guard is joined to a second guard by a dotted line. The second guard is numbered 2 and is labeled ‘Else if time left is more than zero.’ The second guard’s transition targets the Playing state."
    sources={{
      light: useBaseUrl('/transitions-and-events/guards/guards.png'),
      dark: useBaseUrl('/transitions-and-events/guards/guards-dm.png'),
    }}
  />
</p>

:::studio

In the Stately Studio, guards are numbered in the order they are checked and labeled with “if” or “else if” along with their condition. Multiple guards on the same events are connected with a dotted line.

:::

TODO: Why you might use a guard with example.

### Add a guard to an event

First, select the event where you want to add a guard. Then…

#### Using the **+ Transition** button

1. Use the **+ Transition** button to replace your event with a guarded transition.
2. Name your guard by replacing the **New guard** text inside the event.

#### Using the **quick actions** menu

1. Right-click the event to bring up the **quick actions** menu.
2. Choose **Add guard** from the options in the **quick actions** menu to replace your event with a guarded transition.
3. Name your guard by replacing the **New guard** text inside the event.

#### Using the **Transition details** panel

1. Open the **Transition details** panel from the right tool menu.
2. Use the **Guard** text input to name your guard and replace your event with a guarded transition.

Use the **+ Transition** button to create more guards on the same transition.

A guarded transition is a transition that is enabled only if has a conditional `guard` that evaluates to `true`. The guard determines whether or not the transition can be enabled.

- Guards should be pure functions that return a boolean

## Inline guards

```ts
on: {
  event: {
    guard: ({ context, event }) => true,
    target: 'target'
  }
}
```

## Guard object

```ts
on: {
  event: {
    guard: { type: 'isValid', params: { ... } },
    target: 'target'
  }
}
```

- Show `.provide({ guards })` and how `params` can be accessed there
- Useful for custom guards

## Higher-level guards

- `and(...)` - evaluates to `true` if all guards in `and([...guards])` evaluate to `true`
- `or(...)` - evaluates to `true` if _any_ guards in `or([...guards])` evaluate to `true`
- `not(...)` - evaluates to `true` if the guard in `not(guard)` evaluates to `false`

```ts
on: {
  event: {
    guard: and(['isValid', 'isAuthorized']);
  }
}
```

Can be combined:

```ts
on: {
  event: {
    guard: and(['isValid', or(['isAuthorized', 'isGuest'])]);
  }
}
```

## In-state guards

TODO: add link below

Most useful for parallel states (TODO: link)

```ts
on: {
  event: {
    guard: stateIn('#state1');
  }
}
```

## Shorthands

For simple guards: `guard: 'something'`

- `and(['isValid', 'isAuthorized'])`

## TypeScript

## Cheatsheet

## Resources
